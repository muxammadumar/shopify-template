<section id="pricing" class="ios-section" aria-label="{{ 'pricing.packages' | t }}">
  <div class="ios-wrap">
    {% render 'ios-section-header', title: section.settings.title, subtitle: section.settings.subtitle %}

    <div class="ios-pricing">
      {% for block in section.blocks %}
        <div class="ios-glass ios-plan{% if block.settings.featured %} featured{% endif %}" {{ block.shopify_attributes }}>
          <div class="ios-plan-head">
            <div>
              <h3>{{ block.settings.name }}</h3>
              <div class="sub">{{ block.settings.desc }}</div>
            </div>
            <div style="display: flex; gap: 8px; align-items: flex-start;">
              {% if block.settings.was != blank %}
              <span class="ios-badge ios-badge-sale">Sale</span>
              {% endif %}
              <span class="ios-badge">{{ block.settings.tag }}</span>
            </div>
          </div>

          {% if block.settings.price != blank %}
          <div class="ios-price-wrapper">
            {% if block.settings.was != blank %}
              {% assign price_clean = block.settings.price | replace: '€', '' | replace: ',', '.' | replace: ' ', '' | plus: 0 %}
              {% assign was_clean = block.settings.was | replace: '€', '' | replace: ',', '.' | replace: ' ', '' | plus: 0 %}
              {% if was_clean > 0 and price_clean > 0 %}
                {% assign discount_amount = was_clean | minus: price_clean %}
                {% assign discount_percent = discount_amount | times: 100 | divided_by: was_clean %}
                <div class="ios-discount-badge">-{{ discount_percent }}%</div>
              {% endif %}
            {% endif %}
            <div class="ios-price">
              {{ block.settings.price }}
              {% if block.settings.was != blank %}<span class="ios-was">{{ block.settings.was }}</span>{% endif %}
            </div>
          </div>
          {% endif %}

          {% assign has_features = false %}
          {% for i in (1..5) %}
            {% assign key = 'feat' | append: i %}
            {% assign v = block.settings[key] %}
            {% if v != blank %}
              {% assign has_features = true %}
              {% break %}
            {% endif %}
          {% endfor %}
          
          {% if has_features %}
          <ul class="ios-list">
            {% for i in (1..5) %}
              {% assign key = 'feat' | append: i %}
              {% assign v = block.settings[key] %}
              {% if v != blank %}<li>{{ v }}</li>{% endif %}
            {% endfor %}
          </ul>
          {% endif %}

          {% if block.settings.button != blank %}
          <div class="cta">
            <a class="ios-btn {% if block.settings.featured %}primary{% else %}ghost{% endif %}" href="{{ block.settings.link | default: '#' }}">{{ block.settings.button }}</a>
          </div>
          {% endif %}
        </div>
      {% endfor %}
    </div>

    {%- comment -%} Service Schema for Pricing Plans {%- endcomment -%}
    {%- if section.blocks.size > 0 -%}
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Service",
      "name": "{{ shop.name }}",
      "description": "{{ section.settings.subtitle | default: 'Custom Dropshipping Brand: Shop, Branding, Ads & Socials – all in one' | escape }}",
      "provider": {
        "@type": "Organization",
        "name": "{{ shop.name }}"
      },
      "areaServed": {
        "@type": "Country",
        "name": "United States"
      },
      "offers": [
        {%- for block in section.blocks -%}
          {%- if block.type == 'plan' -%}
          {
            "@type": "Offer",
            "name": "{{ block.settings.name | escape }}",
            "description": "{{ block.settings.desc | escape }}",
            "price": "{{ block.settings.price | replace: '€', '' | replace: ',', '.' | strip }}",
            "priceCurrency": "EUR",
            "availability": "https://schema.org/InStock"
          }{%- unless forloop.last -%},{%- endunless -%}
          {%- endif -%}
        {%- endfor -%}
      ]
    }
    </script>
    {%- endif -%}
  </div>
</section>

{% schema %}
{
  "name": "iOS Pricing",
  "settings": [
    { "type": "text", "id": "title", "label": "Title", "default": "Packages" },
    { "type": "textarea", "id": "subtitle", "label": "Subtitle", "default": "Choose your support level and assets." }
  ],
  "blocks": [
    {
      "type": "plan",
      "name": "Plan",
      "settings": [
        { "type": "text", "id": "name", "label": "Name", "default": "Starter" },
        { "type": "text", "id": "desc", "label": "Description", "default": "Small Start" },
        { "type": "text", "id": "tag", "label": "Tag", "default": "One‑time" },
        { "type": "text", "id": "price", "label": "Price", "default": "$49.95" },
        { "type": "text", "id": "was", "label": "Was price", "default": "$69.95" },
        { "type": "checkbox", "id": "featured", "label": "Featured", "default": false },

        { "type": "text", "id": "feat1", "label": "Feature 1", "default": "Complete Shopify Store" },
        { "type": "text", "id": "feat2", "label": "Feature 2", "default": "Product + Supplier (Basic)" },
        { "type": "text", "id": "feat3", "label": "Feature 3", "default": "Logo + Basic Branding" },
        { "type": "text", "id": "feat4", "label": "Feature 4", "default": "1 Ad Creative" },
        { "type": "text", "id": "feat5", "label": "Feature 5", "default": "Legal Templates (Basic)" },

        { "type": "text", "id": "button", "label": "Button text", "default": "Choose" },
        { "type": "text", "id": "link", "label": "Button link", "default": "#cta" }
      ]
    }
  ],
  "max_blocks": 6,
  "presets": [{ "name": "iOS Pricing" }]
}
{% endschema %}

